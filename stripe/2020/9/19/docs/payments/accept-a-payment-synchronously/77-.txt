
@implementation CheckoutViewController

// ...

- (void)pay {
    // Collect card details on the client
    STPPaymentMethodCardParams *cardParams = self.cardTextField.cardParams;
    STPPaymentMethodParams *paymentMethodParams = [STPPaymentMethodParams paramsWithCard:cardParams billingDetails:nil metadata:nil];
    [[STPAPIClient sharedClient] createPaymentMethodWithParams:paymentMethodParams completion:^(STPPaymentMethod *paymentMethod, NSError *createError) {
        // Create PaymentMethod failed
        if (createError != nil) {
            [self displayAlertWithTitle:@"Payment failed" message:createError.localizedDescription ?: @"" restartDemo:NO];
        }
        else if (paymentMethod != nil) {
            // Create a PaymentIntent on the server with a PaymentMethod
            NSLog(@"Created PaymentMethod");
            [self payWithPaymentMethod:paymentMethod.stripeId orPaymentIntent:nil];
        }
    }];
}

// ...

@end

@implementation CheckoutViewController

// ...

- (void)pay {
    // Collect card details on the client
    STPPaymentMethodCardParams *cardParams = self.cardTextField.cardParams;
    STPPaymentMethodParams *paymentMethodParams = [STPPaymentMethodParams paramsWithCard:cardParams billingDetails:nil metadata:nil];
    [[STPAPIClient sharedClient] createPaymentMethodWithParams:paymentMethodParams completion:^(STPPaymentMethod *paymentMethod, NSError *createError) {
        // Create PaymentMethod failed
        if (createError != nil) {
            [self displayAlertWithTitle:@"Payment failed" message:createError.localizedDescription ?: @"" restartDemo:NO];
        }
        else if (paymentMethod != nil) {
            // Create a PaymentIntent on the server with a PaymentMethod
            NSLog(@"Created PaymentMethod");
            [self payWithPaymentMethod:paymentMethod.stripeId orPaymentIntent:nil];
        }
    }];
}

// ...

@end
