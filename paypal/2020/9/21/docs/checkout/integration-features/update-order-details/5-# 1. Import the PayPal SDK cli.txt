# 1. Import the PayPal SDK client that was created in `Set up the Server SDK`.
from sample import PayPalClient
from paypalcheckoutsdk.orders import OrdersPatchRequest, OrdersGetRequest
import json

class PatchOrder(PayPalClient):

    #2. Set up your server to receive a call from the client
    def patch_order(self, order_id):
        """Method to patch order"""
        request = OrdersPatchRequest(order_id)
        request.request_body(self.build_request_body())
        #3. Call PayPal to patch the transaction
        self.client.execute(request)
        response = self.client.execute(OrdersGetRequest(order.id))
        print 'Order ID: ', response.result.id
        print 'Intent: ', response.result.intent
        print 'Links:'
        for link in response.result.links:
            print('\t{}: {}\tCall Type: {}'.format(link.rel, link.href, link.method))
        print 'Gross Amount: {} {}'.format(response.result.purchase_units[0].amount.currency_code,
                                           response.result.purchase_units[0].amount.value)
        json_data = self.object_to_json(response.result)
        print "json_data: ", json.dumps(json_data,indent=4)

    @staticmethod
    def build_request_body():
        """Method to create body for patching the order. Returns a list of patches."""
        return \
            [
                {
                    "op": "replace",
                    "path": "/intent",
                    "value": "CAPTURE"
                },
                {
                    "op": "replace",
                    "path": "/purchase_units/@reference_id=='PUHF'/amount",
                    "value": {
                        "currency_code": "USD",
                        "value": "200.00",
                        "breakdown": {
                            "item_total": {
                                "currency_code": "USD",
                                "value": "180.00"
                            },
                            "tax_total": {
                                "currency_code": "USD",
                                "value": "20.00"
                            }
                        }
                    }
                }
            ]

if __name__ == "__main__":
    PatchOrder().patch_order('REPLACE-WITH-VALID-ORDER-ID')
copy